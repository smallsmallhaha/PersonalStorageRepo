% !TeX encoding = UTF-8
% import ctexart
\documentclass{ctexart}
%\setCJKmainfont{AR PL UMing CN}  %换成本地字体

% headers and footers
\usepackage{fancyhdr}
\pagestyle{plain}
% hyperref
\usepackage{hyperref}
% insert codes
\usepackage{listings}
% math font and formula
\usepackage{amsmath}
\renewcommand{\vec}[1]{\boldsymbol{#1}} % Uncomment for BOLD vectors.

\usepackage{amsfonts}

\usepackage{CJKulem}


% 封面
\title{NOTES}
\author{kekliu\\Wuhan University\\\\Created by \LaTeX}

% 加上公式章节编号
\makeatletter % `@' now normal "letter"
\@addtoreset{equation}{section}
\makeatother  % `@' is restored as "non-letter"
\renewcommand\theequation{\oldstylenums{\thesection}%
	.\oldstylenums{\arabic{equation}}}


% 插入代码
\usepackage{listings}
%\lstset{extendedchars=true}
%\lstset{}
\lstset{numbersep=4pt}

\begin{document}
	
	\maketitle
	% 封面无页码,下一页
	\thispagestyle{empty}
	\pagebreak
	
	\tableofcontents
	% 封面无页码,下一页
	\thispagestyle{empty}
	\pagebreak
	
	%设置第一页页码
	\setcounter{page}{1}
	
	
	
	
	\section{已知运动轨迹，推算向心力}
	\subsection{问题}
	已知物体仅在向心力的作用下沿着给定轨迹运动，求该向心力的规律。
	\subsection{推导}
	为了方便推导，我们假设向心力来自原点。设某个时刻，物体的位置矢量为 $ \vec{r} =(x,y) $，速度矢量为 $ \vec{v}=(v_x,v_y)=v_x (1,y') $，其中，$ y'=\frac{dy}{dx} $。
	\\
	由动量守恒知，$ \vec{r}\times\vec{v}=const $，则$ v_x\propto\frac{1}{y-y'x} $，令
	\begin{equation} v_x=\frac{k}{y-y'x} \end{equation}
	则加速度
	\begin{equation}
	\begin{split}
	\vec{a} &= \frac{d\vec{v}}{dt} = \frac{d\vec{v}}{dx} \frac{dx}{dt} = \frac{d\vec{v}}{dx} v_x \\
	&= \frac{k^2 y''}{(y-y'x)^3} (x,y)
	\end{split}
	\end{equation}
	\subsection{推论}
	\noindent
	通过该公式可以得到一些有趣的结果：
	\\若轨迹为圆锥曲线，则指向曲线焦点的向心力反比于距离的平方；
	\\若轨迹为椭圆轨道，则指向椭圆中心的向心力正比于距离；
	\\若轨迹为任意曲线，则仍可通过上述公式计算向心力。
	\subsection{求指向无穷远处的力的规律}
	给定一个曲线，假设其只受到来自无穷远方向的力，求该力的规律。
	取力的方向为y轴，与y轴垂直的为x轴。
	设某个时刻，物体的位置矢量为 $ \vec{r} =(x,y) $。则由水平方向不受力
	易知 $dx / v_x = dt$ ，竖直方向有
	\begin{equation}
	v_y = v_x y'
	\end{equation}
	\begin{equation}
	F = m a_y = m v_x \frac{y'}{dt} = m v_x \frac{dy'}{dx / v_x} = m v_x^2 y''
	\end{equation}
	\paragraph{结论}
	指向无穷远处的力与二阶导数成正比。
	特别地，抛物线受到的力为常量。
	
	
	
	\section{地球上太阳直射点的周年运动规律}
	\subsection{结果}
	太阳从春分点到北回归线赤经和赤纬的变化
	\begin{equation}
	\begin{split}
	\varDelta L &= arctan(cos(23°26') tan(\theta_t)) \\
	\varDelta B &= arcsin(sin(23°26') sin(\theta_t))
	\end{split}
	\end{equation}
	\paragraph{注意}
	$ \theta_t $ 表示太阳在黄道面上扫过的角度，当轨道为正圆时与时间成正比。
	
	
	\section{求解椭球体上的测地线}
	\subsection{推导}
	
	
	\section{刚体在三维空间中运动表示}
	本章主要探究坐标和坐标系在三维空间中的旋转变换规律。
	\subsection{旋转表示}
	\subsubsection{欧拉角}
	莱昂哈德·欧拉用欧拉角来描述刚体在三维欧几里得空间的方向。对于任何参考系，一个刚体的方向，是依照顺序，从这参考系，做三个欧拉角的旋转而设定的。换句话说，任何关于刚体旋转的旋转矩阵都是由三个基本旋转矩阵复合而成的。
	\\\indent
	根据旋转轴顺序的不同，可以把旋转分为12种：
	Proper Euler angles (z-x-z, x-y-x, y-z-y, z-y-z, x-z-x, y-x-y)
	Tait–Bryan angles (x-y-z, y-z-x, z-x-y, x-z-y, z-y-x, y-x-z).
	Tait–Bryan angles are also called Cardan angles; nautical angles; heading, elevation, and bank; or yaw, pitch, and roll.
	\subsubsection{内旋和外旋}
	对于在三维空间里的一个参考系，任何坐标系的取向，都可以用三个欧拉角来表现。参考系又称为实验室参考系，是静止不动的。连续的旋转可以分为内旋和外旋两种：若坐标系依托于参考系建立，则为外旋；若坐标系根据刚体建立，则为内旋。
	\\\indent
	举个例子，想象一个飞机，若以东为X轴、北为Y轴、上为Y轴建立坐标系，则为外旋；若以飞机右翼为X轴、机头为Y轴、上方为Z轴建立坐标系，则为内旋。因此，二者的关键区别是：外旋的坐标系是固定的，内旋的坐标系是移动的。
	\\\indent
	内旋（intrinsic）是基于移动坐标系的旋转，旋转过程中坐标系基准相对于旋转体不变、相对于外部环境变化。
	\\\indent
	外旋（extrinsic）是基于固定坐标系的旋转，旋转过程中坐标系基准相对于外部环境不变、相对于旋转体变化。
	\subsubsection{坐标和坐标系变换}
	坐标系变换：假设空间中有多个坐标系，求解同一个点在不同坐标系下的坐标或求解坐标系变换关系，是坐标系变换的基本内容，坐标系变换可以用外旋或内旋表示。
	\\\indent
	坐标变换：已知一个固定坐标系，求刚体进行旋转平移时刚体上点的变换（外旋）。
	\subsubsection{基、坐标和旋转矩阵}
	\paragraph{基和坐标}
	设有序向量组 $B={\beta_1,\beta_2,...,\beta_n} \subset R^n$ ，如果B线性无关，则 $R^n$ 中任一向量均可由B线性表示，即
	\begin{equation}
	\alpha=a_1 \beta_1 + a_2 \beta_2 + ... + a_n \beta_n
	\end{equation}
	就称B是$R^n$下的一组基，有序数组 $(a_1,a_2,...,a_n)$ 是向量 $\alpha$ 关于基B的坐标。记为
	\begin{equation}
	\alpha_B =
	\begin{bmatrix}
	a_1 & a_2 & ... & a_n
	\end{bmatrix}^T
	\end{equation}
	\paragraph{旋转矩阵}
	设 $R^n$ 的两组基 $B=[\beta_1,\beta_2,...,\beta_n]$ 和 $B'=[\beta '_1,\beta '_2,...,\beta '_n]$ 满足 $B' = B A$ ，则矩阵A称为旧基B1到新基B2的过渡矩阵（变换矩阵）。
	\\
	同一向量在不同的基下有不同的坐标，如 $ \alpha = B \alpha_{B} = B' \alpha_{B'}$ ，其中 $\alpha_{B},\alpha_{B'}$ 为坐标向量(列向量)，则有
	\begin{equation}
	\alpha_{B'} = A^{-1} \alpha_{B}
	两个标准正交基之间的过渡矩阵一般被称为旋转矩阵。
	\end{equation}
	\paragraph{二维旋转矩阵}
	二维的旋转矩阵表示如下：
	\begin{equation}
	R =
	\begin{bmatrix}
	\cos \theta & \sin \theta \\
	-\sin \theta & \cos \theta
	\end{bmatrix}
	\end{equation}
	对于该式你可以有以下两种理解：\\
	它既可以表示旋转$\theta$角的坐标系变换，也可以表示旋转$-\theta$角的坐标变换。注意，逆时针为正方向。
	\subsubsection{欧拉角到旋转矩阵}
	\paragraph{欧拉角和旋转矩阵}
	对应的旋转矩阵分别为
	\begin{equation}
	R_x(\theta_x)=
	\begin{bmatrix}
	1 & 0 & 0 \\
	0 & \cos \theta_x & \sin \theta_x \\
	0 & -\sin \theta_x & \cos \theta_x
	\end{bmatrix}
	\end{equation}
	\begin{equation}
	R_y(\theta_y)=
	\begin{bmatrix}
	\cos \theta_y & 0 & -\sin \theta_y \\
	0 & 1 & 0 \\
	\sin \theta_y & 0 & \cos \theta_y
	\end{bmatrix}
	\end{equation}
	\begin{equation}
	R_z(\theta_z)=
	\begin{bmatrix}
	\cos \theta_z & \sin \theta_z & 0 \\
	-\sin \theta_z & \cos \theta_z & 0 \\
	0 & 0 & 1
	\end{bmatrix}
	\end{equation}
	按照 Z-Y-X 的旋转顺序旋转，旋转矩阵应为
	\begin{equation}
	R=R_x(\theta_x) R_y(\theta_y) R_z(\theta_z)
	\end{equation}
	点的坐标在旋转后的变化为
	\begin{equation}
	p' = R p
	\end{equation}
	其中，$p,p'$分别为旋转前后基下的坐标，因此上述进行的是\textbf{内旋坐标系变换}。
	
	\paragraph{内旋和外旋（坐标系变换）}
	从上一小节可以看出，内旋坐标系变换只需左乘变换矩阵即可。例如，绕当前坐标系的z轴旋转的坐标系变换为
	\begin{equation}
	p' = R_{z,intri} R p = (R_{z,intri} R) p
	\end{equation}
	外旋坐标系变换可以看成内旋的叠加。例如，绕初始坐标系的z轴旋转的坐标系变换是以下坐标系变换的叠加：变换回原始坐标系($R^{-1}$)->绕z轴旋转$R_{z,extri}$->从原始坐标系变换回来$R$，可以用公式表示为
	\begin{equation}
	p' = R R_{z,extri} R^{-1} R p = R R_{z,extri} p = (R R_{z,extri}) p
	\end{equation}
	可以看出，内旋左乘旋转矩阵，外旋右乘旋转矩阵。\\
	内旋XYZ的变换为
	\begin{equation}
	R_{extri,frame}=R_z(\theta_z) R_y(\theta_y) R_x(\theta_x)
	\end{equation}
	外旋XYZ的变换为
	\begin{equation}
	R_{intri,coord}=R_x(\theta_x) R_y(\theta_y) R_z(\theta_z)
	\end{equation}
	因此，内旋XYZ\textbf{等价于}外旋ZYX。请注意，本节讨论的都是坐标系变换。
	
	\paragraph{三维空间刚体变换（含平移）}
	无论内旋还是外旋，平移变换都是对旋转矩阵左乘，结合上面的内旋左乘、外旋右乘，可以得到下面的结论：\\
	对于外旋，先平移后旋转或者先旋转后平移没有区别，都可以写成
	\begin{equation}
	T_{extri} = T_t \cdot T_{init} \cdot T_R
	\end{equation}
	其中，$T_{init}$是刚体的初始位姿。\\
	对于内旋，平移旋转是有先后区别的，先平移后旋转是
	\begin{equation}
		T_{intri,t-R} = T_R \cdot T_t \cdot T_{init}
	\end{equation}
	先旋转后平移是
	\begin{equation}
	T_{intri,R-t} = T_t \cdot T_R \cdot T_{init}
	\end{equation}
	其中，$T_{init}$是坐标系的初始位姿。
	
	\paragraph{坐标系变换和坐标变换}（含内外旋）
	\\
	内旋XYZ的坐标系变换的物理意义为：要旋转的是一个坐标系，坐标系随刚体运动，依次绕该坐标系XYZ旋转，R为空间上同一个点在基准坐标系和新坐标系之间的坐标变换矩阵。显然，公式为
	\begin{equation}
	R_{intri,frame}=R_z(\theta_z) R_y(\theta_y) R_x(\theta_x) \label{eq1}
	\end{equation}
	外旋XYZ的坐标系变换的物理意义为：要旋转的是一个坐标系，基准坐标系固定不动，依次绕基准坐标系XYZ旋转，R为空间上同一个点在基准坐标系和新坐标系之间的坐标变换矩阵。由公式(\ref{eq1})及推导可知，公式为
	\begin{equation}
	R_{extri,frame}=R_x(\theta_x) R_y(\theta_y) R_z(\theta_z) \label{eq2}
	\end{equation}
	内旋XYZ的坐标变换的物理意义为：要旋转的是一个刚体，坐标系随刚体运动，依次绕该坐标系XYZ旋转，R为刚体上一个点旋转前后的坐标变换矩阵。由公式(\ref{eq4})及推导可知，公式为
	\begin{equation}
	R_{intri,coord}=R_x(-\theta_x) R_y(-\theta_y) R_z(-\theta_z) \label{eq3}
	\end{equation}
	外旋XYZ的坐标变换的物理意义为：要旋转的是一个刚体，基准坐标系固定不动，依次绕基准坐标系XYZ旋转，R为刚体上一个点旋转前后的坐标变换矩阵。显然，公式为
	\begin{equation}
	R_{intri,coord}=R_z(-\theta_z) R_y(-\theta_y) R_x(-\theta_x) \label{eq4}
	\end{equation}
	其中，公式(\ref{eq1})、(\ref{eq2})、(\ref{eq4})的物理意义都容易理解，公式(\ref{eq3})稍微难理解一些，可以认为是刚体本身有一个与刚体相对静止的坐标系，旋转后刚体上的点只有两种坐标：旋转前外部固定坐标系下的坐标、旋转后在外部固定坐标系下的坐标，它们之间的变换即对应公式(\ref{eq3})。
	\begin{equation}
	R_{intri,frame} R_{intri,coord} = I
	\end{equation}
	\begin{equation}
	R_{extri,frame} R_{extri,coord} = I
	\end{equation}
	因此，有以下结论：
	% 小字体居中
	\begin{center}
		\footnotesize 内旋XYZ的坐标系变换	$\Leftrightarrow$ 内旋-Z-Y-X的坐标变换
		\\
		$\Leftrightarrow$ 外旋ZYX的坐标系变换$\Leftrightarrow$ 外旋-X-Y-Z的坐标变换
	\end{center}
	
	\subsubsection{MATLAB中的转换函数}
	MATLAB中有两个转换函数（angle2dcm和dcm2angle）可以用于欧拉角和旋转矩阵之间的转换。请注意，MATLAB中的欧拉角全都是外旋，旋转轴的顺序可以自己指定。
	\\\indent
	\begin{equation}
		angle2dcm(r_1,r_2,r_3,'xyz')=R_z(r_3) R_y(r_2) R_x(r_1)
	\end{equation}
	\\\indent
	angle2dcm的函数说明如下：
	\small
	\begin{lstlisting}{language=Matlab}
function dcm = angle2dcm( r1, r2, r3, varargin )
%  ANGLE2DCM Create direction cosine matrix from rotation angles.
%   N = ANGLE2DCM( R1, R2, R3 ) calculates the direction cosine matrix, N,
%   for a given set of rotation angles, R1, R2, R3.   R1 is an M array of
%   first rotation angles.  R2 is an M array of second rotation angles. R3
%   is an M array of third rotation angles.  N returns an 3-by-3-by-M
%   matrix containing M direction cosine matrices.  Rotation angles are
%   input in radians.  
%
%   N = ANGLE2DCM( R1, R2, R3, S ) calculates the direction cosine matrix,
%   N, for a given set of rotation angles, R1, R2, R3, and a specified
%   rotation sequence, S. 
%
%   The default rotation sequence is 'ZYX' where the order of rotation
%   angles for the default rotation are R1 = Z Axis Rotation, R2 = Y Axis
%   Rotation, and R3 = X Axis Rotation. 
%
%   All rotation sequences, S, are supported: 'ZYX', 'ZYZ', 'ZXY', 'ZXZ',
%   'YXZ', 'YXY', 'YZX', 'YZY', 'XYZ', 'XYX', 'XZY', and 'XZX'.
%
%   Examples:
%
%   Determine the direction cosine matrix from rotation angles:
%      yaw = 0.7854; 
%      pitch = 0.1; 
%      roll = 0;
%      dcm = angle2dcm( yaw, pitch, roll )
%
%   Determine the direction cosine matrix from multiple rotation angles:
%      yaw = [0.7854 0.5]; 
%      pitch = [0.1 0.3]; 
%      roll = [0 0.1];
%      dcm = angle2dcm( pitch, roll, yaw, 'YXZ' )
	\end{lstlisting}
	
	\subsubsection{附录}
	欧拉角: \url{https://en.wikipedia.org/wiki/Euler_angles}
	（该词条的Rotation Matrix一节中的旋转矩阵表表示的是外旋，MATLAB表示的是内旋）
	\\\indent
	旋转矩阵: \url{https://en.wikipedia.org/wiki/Rotation_matrix}
	\\\indent
	四元数: \url{https://en.wikipedia.org/wiki/Quaternion}
	
	
	\subsection{李群和李代数 *}
	\subsubsection{预备知识}
	对给定的两个三维实数向量，他们的叉积可以通过下面的公式计算
	\begin{equation}
	u \times v =
	\begin{bmatrix}
	u_2 v_3 - u_3 v_2 \\
	u_3 v_1 - u_1 v_3 \\
	u_1 v_2 - u_2 v_1
	\end{bmatrix}
	\in \mathbb{R}^3
	\end{equation}
	我们可以把叉积通过如下方式表示：
	\begin{equation}
	u \times v =
	\hat{u} v =
	\begin{bmatrix}
	0 & -u_3 & u_2 \\
	u_3 & 0 & -u_1 \\
	-u_2 & u_1 & 0
	\end{bmatrix}
	v
	\end{equation}
	\subsubsection{旋转矩阵与$so(3)$}
	旋转矩阵有如下性质
	\begin{equation}
	R(t) R^T(t) = I
	\end{equation}
	
	\begin{equation}
	\dot{R}(t) R^T(t) = -(\dot{R}(t) R^T(t))^T
	\end{equation}
	
	\begin{equation}
	\dot{R}(t) = \hat{\omega}(t) R(t)
	\end{equation}
	
	李代数
	\begin{equation}
	so(3) = \{ \hat{\omega} \in \mathbb{R}^{3\times 3} | \omega \in \mathbb{R}^3 \}
	\end{equation}
	
	李群
	\begin{equation}
	SO(3) = \{ R \in \mathbb{R}^{3\times 3} | R^T R = I \}
	\end{equation}
	
	
	\section{全景相片拼接}
	记像素点坐标为p，校正后像片内参为K，像空间辅助坐标系和世界坐标系间的变换为R和t。
	\begin{equation}
	sp=K(RW+t)
	\end{equation}
	
	把$K^{-1}$移到左边，得到
	\begin{equation}
	sK^{-1}p=RW+t
	\end{equation}
	
	令$P=K^{-1}p$，则
	\begin{equation}
	sP=RW+t \label{camera_base}
	\end{equation}
	
	\subsection{推导一}
	由$P$的最后一行为1可知，
	\begin{equation}
	s=R^{(3)}W+t^{(3)}
	\end{equation}
	
	代入公式（\ref{camera_base}）可知
	\begin{equation}
	(PR^{(3)}-R)W=t-Pt^{(3)} \label{wrong_label}
	\end{equation}
	
	对于左右两个相机，有
	\begin{equation}
	(P_1 R_1^{(3)} - R_1)(t_2 - P_2 t_2^{(3)})=
	(P_2 R_2^{(3)} - R_2)(t_1 - P_1 t_1^{(3)})
	\end{equation}
	
	该公式中，除了$P_2$是待求量，其它全都是已知的。
	不妨记$k1=R_2^{(3)} (t_1 - P_1 t_1^{(3)})$，$C=P_1 R_1^{(3)} - R_1$，$k2=t_2^{(3)$，$V=(P_1 R_1^{(3)} - R_1)t_2 + R_2(t_1 - P_1 t_1^{(3)})$，则上式可化简为
	\begin{equation}
	P_2 k_1 + C P_2 k_2 = V
	\end{equation}
	
	考虑到$k_1$ $k_2$都是1x1方阵，可以看成实数，公式可以进一步化简为
	\begin{equation}
	(k_1 E + k_2 C ) P_2 = V
	\end{equation}	
	
	求解上式可得$P_2$坐标。
	
	很遗憾地发现，上述推导从公式（\ref{wrong_label}）开始就是错的，W无法被消去。
	
	\subsection{推导二}
	本推导的目的是通过公式（\ref{camera_base}）将像片上的像点坐标投影到虚拟像空间坐标系，从而进一步投影到圆柱面或球面，生成全景影像。
	设虚拟像空间坐标系表示为$R',t'$，相片的像空间辅助坐标系表示为$R, t$，则由公式（\ref{camera_base}）可以得到
	\begin{equation}
	W = R^{-1} (P - t) = R'^{-1} (P' - t') \label{quanjingpinjie}
	\end{equation}
	上式中的$P$对应于于公式（\ref{camera_base}）中的$sP$，是像空间辅助坐标系下的坐标。
	因此有
	\begin{equation}
	P = s K^{-1} p \label{image_to_xyz}
	\end{equation}
		
	将公式（\ref{image_to_xyz}）代入公式（\ref{quanjingpinjie}），得到
	\begin{equation}
	P' = R' R^{-1} (s K^{-1} p - t) + t'
	\end{equation}
	
	记$\vec{v_1} = R' R^{-1} K^{-1} p = \begin{bmatrix}
	a & b & c
	\end{bmatrix}' $，$\vec{v_2} = t' - R' R^{-1} t = \begin{bmatrix}
	m & n & o
	\end{bmatrix}'$，则最终可以得到公式
	\begin{equation} \label{get_P_}
	P' = s
	\begin{bmatrix}
	a \\ b \\ c
	\end{bmatrix}
	+
	\begin{bmatrix}
	m \\ n \\ o
	\end{bmatrix}	
	\end{equation}
	
	在圆柱面投影中，结合公式${P'}_x^2 + {P'}_y^2 = R^2$可以得到一个一元二次方程。该方程必然有正负两个解，负解舍去，正解为
	\begin{equation}
	\begin{split}
	s
	&= \frac{\sqrt{(\vec{v_1}\cdot\vec{v_2})^2 - \vec{v_1}^2(\vec{v_2}^2-R^2)} - \vec{v_1}\cdot\vec{v_2}}{\vec{v_1}^2} \\
	&= \frac{\sqrt{(am+bn)^2-(a^2+b^2)(m^2+n^2-R^2)}-(am+bn)}{a^2+b^2} \\
	&= \frac{\sqrt{(a^2+b^2)R^2 - (an-bm)^2}-(am+bn)}{a^2+b^2}
	\end{split}
	\end{equation}
	
	在球面投影中，结合公式式${P'}_x^2 + {P'}_y^2 + {P'}_z^2 = R^2$可以得到一个一元二次方程。该方程必然有正负两个解，负解舍去，正解为
	\begin{equation}
	\begin{split}
	s
	&= \frac{\sqrt{(\vec{v_1}\cdot\vec{v_2})^2 - \vec{v_1}^2(\vec{v_2}^2-R^2)} - \vec{v_1}\cdot\vec{v_2}}{\vec{v_1}^2} \\
	&=\frac{\sqrt{(a m+b n+c o)^2-(a^2+b^2+c^2) (m^2+n^2+o^2-R^2)}-(am+bn+co)}{a^2+b^2+c^2}
	\end{split}
	\end{equation}
	
	\subsection{误差来源}
	\subsubsection{投影差}
	从上面的推导可以知道，虚拟坐标系原点和像素对应的空间点的距离被假定成了R，这会导致距离并非R的像素点在每张图片上都有一个投影偏移，这种偏移在拼接中更为致命：若真实距离大于R，则两个相片拼接重合的部分将偏多，否则偏少。
	\par
	事实上，鉴于R都是假定的，我们甚至可以假设$P_x^2 + P_y^2 = R^2$，这样我们可以直接算出s的值，进一步通过公式（\ref{get_P_}），得到P'点的坐标。
	
	
	
	\section{图像特征描述子}
	\subsection{SIFT}
	\subsubsection{高斯模糊}
	高斯卷积核函数：
	\begin{equation}
	G(x,y,\rho)=\frac{1}{2 \pi \sigma^2} exp\left(-\frac{x^2+y^2}{2\sigma^2}\right)
	\end{equation}
	\par
	高斯卷积核的大小根据$\sigma$确定，一般是奇数维的方阵，方阵半径不超过$[3\sigma]+1$（含中心）。
	\par 高斯模糊具有线性可分的性质，可以在二维图像上对两个独立的一维空间分别进行计算，可以大大减少运算次数。
	\subsubsection{高斯金字塔}
	高斯金字塔的构建过程可以分为两步：高斯平滑、降采样。
	高斯金字塔共o组、s层，则有
	\begin{equation}
	\sigma(s)=\sigma_0 2^{s/S}
	\end{equation}
	公式中的$\sigma$是尺度空间坐标，$s$是层的坐标，$\sigma_0$是初始尺度，$S$是每组的层数。
	\par 高斯金字塔的组内和组间尺度可以归为：
	\begin{equation}
	2^{i-1} (\rho,k\rho,k^2\rho,...,k^{n-1}\rho),
	k=2^{1/S}
	\end{equation}
	\subsubsection{关键点检测:DoG}
	高斯拉普拉斯算子
	\begin{equation}
	LOG(x,y,\rho)=\rho^2 \nabla^2 G
	\end{equation}
	高斯差分算子
	\begin{equation}
	D(x,y,\rho)=\left(G(x,y,k\rho)-G(x,y,\rho)\right)*I(x,y)
	\end{equation}
	\subsubsection{DoG的局部极值检测}
	
	\subsubsection{关键点方向分配}
	
	\subsubsection{关键点描述}
	
	
	
	\section{矩阵求导表示}
	\subsection{布局}
	矩阵求导有两种布局，分子布局(numerator layout)和分母布局(denominator layout)。
	分子布局的导数矩阵布局与分母相同（别问我为啥这样起名字，我也不知道）。
	/par 如无特别说明，下面应用的都是分子布局。	
	\subsection{基本求导规则}
	\subsubsection{基本类型}
	\par 已知标量$s$、$m$维向量$\boldsymbol{x}$、$n$维向量$\boldsymbol{y}$、$s\times t$维矩阵$\boldsymbol{A}$，则有以下基本求导形式：
	
	\par 向量对标量求导$m\times 1$
	\begin{equation}
	\frac{\partial\boldsymbol{x}}{\partial s}
	\end{equation}
	
	\par 标量对向量求导$1\times m$
	\begin{equation}
	\frac{\partial s}{\partial\boldsymbol{x}}
	\end{equation}
	
	\par 向量对向量求导$m\times n$
	\begin{equation}
	\frac{\partial\boldsymbol{x}}{\partial\boldsymbol{y}}
	\end{equation}
	
	\par 矩阵对标量求导$s\times t$
	\begin{equation}
	\frac{\partial\boldsymbol{A}}{\partial s}
	\end{equation}
	
	\par 标量对矩阵求导$t\times s$（？？）
	\begin{equation}
	\frac{\partial s}{\partial\boldsymbol{A}}
	\end{equation}
	
	\subsubsection{推论}
	\begin{equation}
	\frac{\partial \boldsymbol{Ax}}{\partial \boldsymbol{y}}
	=
	A \frac{\partial \boldsymbol{x}}{\partial \boldsymbol{y}}
	\end{equation}
	
	
	
	\section{loam 算法的李代数形式推导}
	loam是CMU张博士提出的一种基于特征的ICP算法，主要使用线特征和面特征两种。
	\subsection{局部优化}
	已知点云$P_1$和$P_2$和点云之间的初始位姿，优化位姿。
	\par 提示，通过"点-直线"和"点-面"距离最小化进行匹配。
	\subsubsection{点-直线距离最小化}
	已知初始位姿的李代数为$\xi$，对于$\forall p \in P_1$，有对应点$p_1,p_2 \in P_2$构成直线，使得点$p$到直线$p_1p_2$的距离最短。距离（实际上是距离的2倍）用向量表示如下
	\begin{equation}
	d_{\epsilon} =
	\frac{|\vec{p p_1} \times \vec{p p_2}|}{|\vec{p_1 p_2}|}
	\end{equation}
	用李代数表示如下（正负号无影响）
	\begin{equation}
	d_{\epsilon} =
	\frac{(p_1-e(\xi ^\wedge)p) 
		^\wedge 
		(p_2-e(\xi ^\wedge)p)}{|\vec{p_1 p_2}|}
	\end{equation}
	\par 记$p'=e(\xi ^\wedge)p$，$p'_1=p_1-p'$，$p'_2=p_2-p'$，$f=(p_1-e(\xi ^\wedge)p) ^\wedge (p_2-e(\xi ^\wedge)p)$，使用李代数扰动模型求导，可以得到
	\begin{equation}
	\begin{split}
	\frac{\partial f}{\partial \delta \xi}
	&=
	\lim\limits_{\delta \xi \rightarrow 0}
	\frac{(p_1-e(\delta \xi ^\wedge) p') 
	^\wedge 
	(p_2-e(\delta \xi ^\wedge) p')
	-
	(p_1-p') ^\wedge (p_2-p')
	}{\delta \xi} \\
	&=
	\lim\limits_{\delta \xi \rightarrow 0}
	\frac{(p_1-(1+\delta \xi ^\wedge) p') 
		^\wedge 
		(p_2-(1+\delta \xi ^\wedge) p')
		-
		(p_1-p') ^\wedge (p_2-p')
	}{\delta \xi} \\
	&=
	\lim\limits_{\delta \xi \rightarrow 0}
	\frac{(p_1-p')^\wedge\delta\xi^\wedge p'- (\delta\xi^\wedge p')^\wedge(p_2-p')}{\delta \xi} \\
	&=
	- (p_1-p')^\wedge p'^\wedge - (p_2-p')^\wedge p'^\wedge \\
	&=
	- (p'_1 - p'_2)^\wedge p'^\wedge
	\end{split}
	\end{equation}
	
	\subsubsection{点-面距离最小化}
	已知初始位姿的李代数为$\xi$，对于$\forall p \in P_1$，有对应点$p_1,p_2,p_3 \in P_2$构成平面，使得点$p$到平面$p_1p_2p_3$的距离最短。距离（实际上是距离的6倍）用向量表示如下
	\begin{equation}
	d_{\epsilon} =
	\frac{|(\vec{p p_1} \times \vec{p p_2}) \cdot \vec{p p_3}|}{|\vec{p_1 p_2 p_3}|}
	\end{equation}
	用李代数表示如下（正负号无影响）
	\begin{equation}
	d_{\epsilon} =
	\frac{
		(p_3-e(\xi ^\wedge)p)
		^{+}(
		(p_1-e(\xi ^\wedge)p) 
		^\wedge 
		(p_2-e(\xi ^\wedge)p))
		}{|\vec{p_1 p_2 p_3}|}
	\end{equation}
	\par 记$p'=e(\xi ^\wedge)p$，$p'_1=p_1-p'$，$p'_2=p_2-p'$，$p'_3=p_3-p'$，$h=(p_3-e(\xi ^\wedge)p)
	^{+}(
	(p_1-e(\xi ^\wedge)p) 
	^\wedge 
	(p_2-e(\xi ^\wedge)p))$，使用李代数扰动模型求导，可以得到
	\begin{equation}
	\begin{split}
	\frac{\partial h}{\partial \delta \xi}
	&=
	(({p'}_1^\wedge p'_2)^{+} - {p'}_3^{+} {p'}_2^\wedge + {p'}_3^{+} {p'}_1^\wedge) p'^\wedge \\
	&=
	(({p'}_1^\wedge p'_2)^{+} p'^\wedge + {p'}_3^{+} ({p'}_1-{p'}_2)^\wedge p'^\wedge
	\end{split}
	\end{equation}
	
	\subsection{全局优化}
	

\end{document}